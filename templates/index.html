<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Antrean Rumah Sakit – Demo Lengkap</title>

    <!-- Bootstrap 5 -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
    >

    <!-- Google Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet"
    >

    <style>
        :root {
            --primary: #2563eb;
            --primary-soft: #e0edff;
            --primary-deep: #1d4ed8;
            --accent: #16a34a;
            --accent-soft: #dcfce7;
            --danger-soft: #fee2e2;
            --warning-soft: #fef3c7;
            --text-main: #0f172a;
            --text-muted: #6b7280;
            --card-bg: #ffffff;
            --bg-body: #f3f4f6;
            --border-subtle: #e5e7eb;
            --shadow-soft: 0 12px 30px rgba(15,23,42,0.06);
            --shadow-hover: 0 16px 40px rgba(15,23,42,0.08);
            --radius-card: 0.9rem;
            --radius-pill: 999px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background:
                radial-gradient(circle at top left, rgba(37,99,235,0.06), transparent 55%),
                radial-gradient(circle at bottom right, rgba(34,197,94,0.04), transparent 55%),
                var(--bg-body);
            color: var(--text-main);
            line-height: 1.5;
        }

        /* NAVBAR */
        .app-navbar {
            background-color: #ffffff;
            border-bottom: 1px solid rgba(15,23,42,0.06);
            box-shadow: 0 10px 24px rgba(15,23,42,0.05);
        }

        .app-navbar .navbar-brand {
            font-weight: 600;
            color: var(--primary-deep) !important;
            letter-spacing: .02em;
            display: flex;
            align-items: center;
            gap: .5rem;
            font-size: 1rem;
        }

        .app-navbar .navbar-brand span {
            font-size: .85rem;
            font-weight: 400;
            opacity: .9;
        }

        .app-navbar .btn-outline-light {
            border-radius: var(--radius-pill);
            border-width: 1px;
            font-size: .8rem;
            padding-inline: 1rem;
            background-color: #f9fafb;
            border-color: var(--border-subtle);
            color: #111827;
            backdrop-filter: blur(0);
            transition: background-color .18s ease-out, color .18s ease-out, box-shadow .18s ease-out, border-color .18s ease-out;
        }

        .app-navbar .btn-outline-light:hover {
            background-color: var(--primary);
            color: #ffffff;
            border-color: var(--primary);
            box-shadow: 0 8px 18px rgba(37,99,235,0.3);
        }

        /* PAGE HEADER */
        .page-header {
            padding-block: 1.9rem 1.25rem;
        }

        .section-label {
            display: inline-flex;
            align-items: center;
            gap: .35rem;
            padding: .25rem .75rem;
            border-radius: var(--radius-pill);
            font-size: .75rem;
            text-transform: uppercase;
            letter-spacing: .08em;
            background-color: #e0f2fe;
            color: #0369a1;
            font-weight: 600;
        }

        .section-label span {
            width: 6px;
            height: 6px;
            border-radius: 999px;
            background: #0ea5e9;
        }

        .page-title {
            font-size: 1.9rem;
            font-weight: 600;
            margin-top: .75rem;
            margin-bottom: .4rem;
        }

        .page-subtitle {
            font-size: .9rem;
            color: var(--text-muted);
            max-width: 640px;
        }

        /* LAYOUT */
        .app-shell {
            padding-top: 1.75rem;
            padding-bottom: 3rem;
        }

        .app-shell hr {
            border-color: rgba(148,163,184,0.35);
            margin-block: 2.25rem;
        }

        h3.section-heading {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* CARD STEP */
        .card-step {
            border-radius: var(--radius-card);
            border: 1px solid rgba(148,163,184,0.28);
            background-color: var(--card-bg);
            box-shadow: var(--shadow-soft);
            transition: box-shadow .18s ease-out, transform .12s ease-out, border-color .18s ease-out;
            overflow: hidden;
        }

        .card-step:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
            border-color: rgba(129,140,248,0.4);
        }

        .card-step .card-header {
            border: none;
            border-bottom: 1px solid rgba(226,232,240,0.9);
            border-radius: var(--radius-card) var(--radius-card) 0 0;
            background: #f9fafb;
            font-weight: 600;
            font-size: .9rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: .5rem;
        }

        .card-step .card-header small {
            font-weight: 500;
            color: var(--text-muted);
            font-size: .75rem;
        }

        .card-step .card-body {
            padding: 1.05rem 1.25rem 1.15rem;
        }

        /* TYPOGRAPHY */
        label,
        .form-label {
            font-size: .8rem;
            font-weight: 500;
            color: #4b5563;
            margin-bottom: .25rem;
        }

        h6 {
            font-size: .85rem;
            font-weight: 600;
            color: #111827;
        }

        small.text-muted {
            font-size: .78rem;
        }

        /* FORMS */
        .form-control,
        .form-select {
            border-radius: .7rem;
            border-color: var(--border-subtle);
            font-size: .85rem;
            padding: .5rem .75rem;
            background-color: #f9fafb;
            transition: border-color .16s ease-out, box-shadow .16s ease-out, background-color .16s ease-out;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 1px rgba(37,99,235,0.08), 0 0 0 3px rgba(191,219,254,0.7);
            background-color: #ffffff;
        }

        .form-text {
            font-size: .75rem;
            color: var(--text-muted);
        }

        /* BUTTONS */
        .btn {
            border-radius: var(--radius-pill);
            font-size: .8rem;
            font-weight: 500;
            padding: .46rem .95rem;
            border-width: 1px;
            transition: background-color .16s ease-out, color .16s ease-out, box-shadow .16s ease-out, border-color .16s ease-out, transform .08s ease-out;
        }

        .btn:active {
            transform: translateY(1px);
            box-shadow: none !important;
        }

        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 8px 18px rgba(37, 99, 235, 0.28);
        }

        .btn-primary:hover {
            background-color: var(--primary-deep);
            border-color: var(--primary-deep);
            box-shadow: 0 10px 22px rgba(37, 99, 235, 0.34);
        }

        .btn-outline-primary {
            border-color: rgba(37,99,235,0.7);
            color: var(--primary-deep);
            background-color: #eff6ff;
        }

        .btn-outline-primary:hover {
            background-color: var(--primary-deep);
            color: #ffffff;
        }

        .btn-success {
            background-color: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 8px 18px rgba(34,197,94,0.28);
        }

        .btn-success:hover {
            background-color: #15803d;
            border-color: #15803d;
            box-shadow: 0 10px 22px rgba(34,197,94,0.35);
        }

        .btn-outline-secondary {
            border-color: #d1d5db;
            color: #4b5563;
            background-color: #f9fafb;
        }

        .btn-outline-secondary:hover {
            background-color: #e5e7eb;
        }

        /* BADGES & STATUS */
        .badge-status,
        .badge {
            border-radius: var(--radius-pill);
        }

        .badge-status {
            font-size: .7rem;
            padding: .26rem .6rem;
            letter-spacing: .02em;
        }

        .badge.bg-danger-subtle {
            background-color: var(--danger-soft) !important;
            color: #b91c1c !important;
        }

        .badge.bg-success-subtle,
        .text-bg-success-subtle {
            background-color: var(--accent-soft) !important;
            color: #166534 !important;
        }

        .badge.bg-warning-subtle {
            background-color: var(--warning-soft) !important;
            color: #92400e !important;
        }

        .badge.bg-primary-subtle {
            background-color: var(--primary-soft) !important;
            color: var(--primary-deep) !important;
        }

        /* API RESPONSE */
        #apiResponse {
            font-family: "JetBrains Mono", Menlo, Consolas, monospace;
            border-radius: .8rem;
            background: #020617;
            background: radial-gradient(circle at top left, rgba(59,130,246,0.28), transparent 65%), #020617;
            border: 1px solid rgba(30,64,175,0.7);
            font-size: .78rem;
            line-height: 1.45;
            color: #e5e7eb;
            max-height: 260px;
            overflow: auto;
            padding: 1rem 1.1rem;
        }

        #apiResponse::-webkit-scrollbar {
            width: 6px;
        }

        #apiResponse::-webkit-scrollbar-thumb {
            background-color: rgba(148,163,184,0.8);
            border-radius: 999px;
        }

        /* TABLES */
        .table {
            font-size: .8rem;
        }

        .table thead tr {
            border-color: rgba(226,232,240,0.9);
        }

        .table thead th {
            font-size: .75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: .05em;
            color: #6b7280;
            background-color: #f9fafb;
        }

        .table tbody tr {
            border-color: rgba(241,245,249,0.9);
        }

        .table tbody tr:nth-child(even) {
            background-color: #f9fafb;
        }

        .queue-row {
            transition: background .14s ease-out, transform .12s ease-out, box-shadow .12s ease-out;
        }

        .queue-row:hover {
            background: var(--primary-soft) !important;
            cursor: pointer;
            transform: translateY(-1px);
            box-shadow: 0 8px 16px rgba(148,163,184,0.35);
        }

        /* RESPONSIVE TWEAKS */
        @media (max-width: 991.98px) {
            .page-title {
                font-size: 1.5rem;
            }
            .page-header {
                padding-block: 1.5rem 1rem;
            }
            .card-step .card-body {
                padding-inline: 1rem;
            }
            .app-shell {
                padding-top: 1.25rem;
            }
        }

        @media (max-width: 575.98px) {
            .page-header {
                text-align: left;
            }
            .page-subtitle {
                max-width: 100%;
            }
            .app-navbar .text-white-50 {
                display: none !important;
            }
        }
    </style>
</head>
<body>

<nav class="navbar app-navbar">
    <div class="container d-flex justify-content-between align-items-center py-2">
        <a class="navbar-brand" href="#">
            Antrean Rumah Sakit
        </a>
        <div class="d-flex gap-2 align-items-center">
            <span class="text-white-50 d-none d-md-inline" style="font-size:.8rem; color:#6b7280 !important;">
                Cek endpoint backend
            </span>
            <a href="/docs" class="btn btn-sm btn-outline-light">
                Dokumentasi Swagger
            </a>
        </div>
    </div>
</nav>

<div class="container app-shell">

    <!-- HEADER -->
    <div class="page-header">
        <div class="section-label">
            <span></span>
            Antrean Rumah Sakit
        </div>
        <h1 class="page-title">
            Antrean Rumah Sakit
        </h1>
        <p class="page-subtitle">
            Simulasikan alur lengkap mulai dari <strong>setup Admin</strong>,
            <strong>registrasi pasien</strong>, sampai <strong>dokter memanggil & menyelesaikan antrean</strong>.
            Semua request API dan respons bisa dilihat di panel bawah.
        </p>
    </div>

    <!-- ================== SECTION A: SETUP DATA ================== -->
    <div class="d-flex align-items-center justify-content-between mb-2 flex-wrap gap-2">
        <h3 class="mb-0 section-heading">
            A. Setup Data <span class="text-muted" style="font-weight:400;">(Admin & Pasien)</span>
        </h3>
        <span class="badge rounded-pill text-bg-success-subtle text-success px-3 py-2" style="font-size:.75rem;">
            1. Admin → 2. Klinik → 3. Dokter → 4. Pasien → 5. Antrean
        </span>
    </div>

    <div class="row g-4 mb-4">
        <!-- ===== Admin & Response ===== -->
        <div class="col-lg-4">
            <!-- Admin Auth -->
            <div class="card card-step mb-4">
                <div class="card-header">
                    <span>1. Admin – Register & Login</span>
                    <small>Role: <span class="badge rounded-pill bg-primary-subtle text-primary">admin</span></small>
                </div>
                <div class="card-body">
                    <form id="admin-register-form" class="mb-3">
                        <h6 class="mb-2">Register Admin</h6>
                        <div class="mb-2">
                            <label class="form-label">Nama</label>
                            <input type="text" class="form-control" id="adminRegName"
                                   placeholder="Nama admin" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="adminRegEmail"
                                   placeholder="admin@example.com" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Kata Sandi</label>
                            <input type="password" class="form-control" id="adminRegPassword"
                                   placeholder="password" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">No. HP</label>
                            <input type="text" class="form-control" id="adminRegPhone"
                                   placeholder="08xxxx" required>
                        </div>
                        <button type="submit" class="btn btn-outline-primary w-100 mb-2">
                            Daftarkan Admin
                        </button>
                    </form>

                    <div class="border-top pt-3 mt-2">
                        <form id="admin-login-form">
                            <h6 class="mb-2">Login Admin</h6>
                            <div class="mb-2">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="adminEmail"
                                       placeholder="admin@example.com" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Kata Sandi</label>
                                <input type="password" class="form-control" id="adminPassword"
                                       placeholder="password" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                Login Admin
                            </button>
                        </form>

                        <div class="mt-3">
                            <small class="text-muted d-block mb-1">Status Admin:</small>
                            <span id="adminStatus" class="badge bg-danger-subtle text-danger">
                                Belum login
                            </span>
                        </div>
                        <div class="mt-2 small text-muted">
                            Token admin: <span id="adminTokenPreview">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Response API -->
            <div class="card card-step">
                <div class="card-header">
                    <span>7. Respons API</span>
                    <small>Request terakhir</small>
                </div>
                <div class="card-body">
                    <pre id="apiResponse" class="text-light mb-0">
Belum ada request.
                    </pre>
                </div>
            </div>
        </div>

       <!-- ==================== KLINIK & DOKTER ==================== -->
<div class="col-lg-6">

    <!-- ===================== KLINIK ===================== -->
    <div class="card card-step mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <span>2. Klinik</span>
            <button id="btnLoadClinics" class="btn btn-sm btn-outline-primary">Muat Klinik</button>
        </div>

        <div class="card-body">
            <form id="clinic-form" class="mb-3">
                <h6 class="mb-2">Buat Klinik</h6>

                <label class="form-label">Nama Klinik</label>
                <input type="text" class="form-control mb-2" id="clinicName" placeholder="Klinik Umum" required>

                <label class="form-label">Deskripsi</label>
                <input type="text" class="form-control mb-3" id="clinicDesc" placeholder="Deskripsi singkat">

                <button class="btn btn-success w-100">Simpan Klinik</button>
            </form>

            <div class="table-responsive">
                <table class="table table-sm mb-0 align-middle">
                    <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Nama Klinik</th>
                    </tr>
                    </thead>
                    <tbody id="clinicTableBody">
                    <tr>
                        <td colspan="2" class="text-muted text-center py-3">
                            Belum ada data. Klik <strong>Muat Klinik</strong>.
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <small class="text-muted d-block mt-2">
                Gunakan <strong>clinic_id</strong> untuk menambahkan dokter.
            </small>
        </div>
    </div>


    <!-- ===================== DOKTER ===================== -->
    <div class="card card-step">
        <div class="card-header">
            <span>3. Dokter</span>
        </div>

        <div class="card-body">
            <form id="doctor-form">
                <h6 class="mb-2">Tambah Dokter</h6>

                <!-- Dropdown Klinik -->
                <label class="form-label">Klinik</label>
                <select class="form-control mb-3" id="docClinicSelect">
                    <option value="">-- pilih klinik --</option>
                </select>

                <label class="form-label">Nama Dokter</label>
                <input type="text" class="form-control mb-2" id="docName" placeholder="Dr. Andi" required>

                <label class="form-label">Email</label>
                <input type="email" class="form-control mb-2" id="docEmail" placeholder="dokter@example.com" required>

                <label class="form-label">Password</label>
                <input type="password" class="form-control mb-2" id="docPassword" placeholder="Password" required>

                <label class="form-label">No. HP</label>
                <input type="text" class="form-control mb-3" id="docPhone" placeholder="08xxxx" required>

                <label class="form-label">Spesialisasi</label>
                <input type="text" class="form-control mb-3" id="docSpec" placeholder="Umum / Anak / lainnya" required>

                <button class="btn btn-warning w-100">Simpan Dokter</button>
            </form>

            <div class="table-responsive mt-3">
                <table class="table table-sm mb-0 align-middle">
                    <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Dokter</th>
                        <th>Klinik</th>
                    </tr>
                    </thead>
                    <tbody id="doctorTableBody">
                    <tr>
                        <td colspan="3" class="text-muted text-center py-3">
                            Belum ada data dokter.
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

            <!-- Daftar Antrean Pasien -->
            <div class="card card-step">
                <div class="card-header">
                    <span>5. Pasien – Daftar Antrean</span>
                    <small>Butuh login pasien</small>
                </div>
                <div class="card-body">
                    <form id="queue-register-form" class="mb-3">
                        <div class="mb-2">
                            <label class="form-label">clinic_id</label>
                            <input type="text" class="form-control" id="queueClinicId"
                                   placeholder="clinic-001" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">doctor_id</label>
                            <input type="text" class="form-control" id="queueDoctorId"
                                   placeholder="doctor-001" required>
                        </div>
                        <button type="submit" class="btn btn-success w-100">
                            Daftar Antrean (POST /api/queues/register)
                        </button>
                    </form>

                    <small class="text-muted">
                        Simpan <strong>queue.id</strong> dari respons untuk dipakai
                        dokter di bagian B.
                    </small>
                </div>
            </div>
        </div>
    </div>

     <!-- Complete & Call Queue -->
        <div class="col-lg-8">
            <div class="card card-step mb-4">
                <div class="card-header">
                    <span>7. Selesaikan Antrean (Panggil + Complete)</span>
                    <span class="badge rounded-pill text-bg-success-subtle text-success">
                        Data ala Kaggle
                    </span>
                </div>
                <div class="card-body">
                    <form id="complete-queue-form" class="row g-3">
                        <div class="col-12">
                            <label class="form-label">Queue ID</label>
                            <input type="text" class="form-control" id="queueId"
                                   placeholder="klik antrean di tabel atau isi manual" required>
                            <div class="form-text">
                                Dipilih dari tabel antrean di bawah atau dari respons pasien.
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Keluhan / Alasan Kunjungan</label>
                            <input type="text" class="form-control" id="reason"
                                   value="Demam dan batuk" required>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Jumlah Pembayaran</label>
                            <input type="number" class="form-control" id="paymentAmount"
                                   value="200000" required>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Metode Pembayaran</label>
                            <select class="form-control" id="modeOfPayment" required>
                                <option value="Transfer">Transfer</option>
                                <option value="Cash" selected>Cash</option>
                                <option value="Qris">QRIS</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Jenis Kunjungan</label>
                            <select class="form-control" id="modeOfAppointment" required>
                                <option value="In Person" selected>Tatap Muka (In Person)</option>
                                <option value="Telepon">Telepon</option>
                                <option value="Online">Online / Video Call</option>
                            </select>
                        </div>

                        <div class="col-12 d-flex flex-wrap gap-2 mt-1">
                            <button type="button" id="btnCallQueue" class="btn btn-outline-primary">
                                Panggil Antrean (ubah ke IN_SERVICE)
                            </button>

                            <button type="submit" class="btn btn-success">
                                Selesaikan Antrean dengan Data Kaggle
                            </button>

                            <button type="button" id="btnResetForm" class="btn btn-outline-secondary">
                                Reset Formulir
                            </button>
                        </div>
                    </form>
                </div>
            </div>

    

<!-- ================== SECTION B: PASIEN ( REGISTER + DAFTAR ) ================== -->

 <hr class="my-4">
<div class="d-flex align-items-center justify-content-between mb-2 flex-wrap gap-2">
    <h3 class="mb-0 section-heading">
        B. Pasien – Registrasi & Pengelolaan Antrean
    </h3>
    <span class="badge rounded-pill text-bg-primary-subtle text-primary px-3 py-2" style="font-size:.75rem;">
        Login → Pilih Klinik → Daftar Antrean → Cek Status
    </span>
</div>


 <!-- ===== Pasien & Antrean ===== -->
        <div class="col-lg-4">
            <!-- Pasien -->
            <div class="card card-step mb-4">
                <div class="card-header">
                    <span>4. Pasien – Register & Login</span>
                    <small>Role: <span class="badge rounded-pill bg-primary-subtle text-primary">patient</span></small>
                </div>
                <div class="card-body">
                    <form id="patient-register-form" class="mb-3">
                        <h6 class="mb-2">Register Pasien</h6>
                        <div class="mb-2">
                            <label class="form-label">Nama</label>
                            <input type="text" class="form-control" id="patName"
                                   placeholder="Nama pasien" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="patEmail"
                                   placeholder="patient@example.com" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Kata Sandi</label>
                            <input type="password" class="form-control" id="patPassword"
                                   placeholder="Password pasien" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">No. HP</label>
                            <input type="text" class="form-control" id="patPhone"
                                   placeholder="No. HP pasien" required>
                        </div>
                        <button type="submit" class="btn btn-outline-primary w-100">
                            Daftarkan Pasien
                        </button>
                    </form>

                    <div class="border-top pt-3 mt-2">
                        <form id="patient-login-form">
                            <h6 class="mb-2">Login Pasien</h6>
                            <div class="mb-2">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="patLoginEmail"
                                       placeholder="patient@example.com" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Kata Sandi</label>
                                <input type="password" class="form-control" id="patLoginPassword"
                                       placeholder="Password pasien" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                Login Pasien
                            </button>
                        </form>

                        <div class="mt-3">
                            <small class="text-muted d-block mb-1">Status Pasien:</small>
                            <span id="patientStatus" class="badge bg-danger-subtle text-danger">
                                Belum login
                            </span>
                        </div>
                        <div class="mt-2 small text-muted">
                            Token pasien: <span id="patientTokenPreview">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Daftar Antrean Pasien -->
            <div class="card card-step">
                <div class="card-header">
                    <span>5. Pasien – Daftar Antrean</span>
                    <small>Butuh login pasien</small>
                </div>
                <div class="card-body">
                    <form id="queue-register-form" class="mb-3">
                        <div class="mb-2">
                            <label class="form-label">clinic_id</label>
                            <input type="text" class="form-control" id="queueClinicId"
                                   placeholder="clinic-001" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">doctor_id</label>
                            <input type="text" class="form-control" id="queueDoctorId"
                                   placeholder="doctor-001" required>
                        </div>
                        <button type="submit" class="btn btn-success w-100">
                            Daftar Antrean (POST /api/queues/register)
                        </button>
                    </form>

                    <small class="text-muted">
                        Simpan <strong>queue.id</strong> dari respons untuk dipakai
                        dokter di bagian B.
                    </small>
                </div>
            </div>
        </div>
    </div>
<!-- Pasien – Cek Status Antrean -->
<div class="card card-step mt-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>6. Pasien – Cek Status Antrean</span>
        <button id="btnCheckQueue" class="btn btn-sm btn-outline-secondary">
            Cek Antrean
        </button>
    </div>

    <div class="card-body">
        <div class="mb-3">
            <label class="form-label">Masukkan Queue ID</label>
            <input type="text" class="form-control" id="queueCheckInput"
                   placeholder="queue-001">
        </div>

        <div class="table-responsive">
            <table class="table table-sm align-middle mb-0">
                <thead class="table-light">
                <tr>
                    <th>Queue ID</th>
                    <th>No. Antrean</th>
                    <th>Status</th>
                    <th>Dokter</th>
                    <th>Klinik</th>
                </tr>
                </thead>
                <tbody id="queueCheckTableBody">
                <tr>
                    <td colspan="5" class="text-muted text-center py-3">
                        Masukkan Queue ID lalu klik <strong>Cek Antrean</strong>.
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>




    <!-- ================== SECTION C: DOKTER (CALL + COMPLETE) ================== -->
    <hr class="my-4">
    <div class="d-flex align-items-center justify-content-between mb-2 flex-wrap gap-2">
        <h3 class="mb-0 section-heading">
            B. Dokter – Kunjungan & Selesaikan Antrean
        </h3>
        <span class="badge rounded-pill text-bg-success-subtle text-success px-3 py-2" style="font-size:.75rem;">
            Login Dokter → Muat Antrean → Panggil → Selesaikan
        </span>
    </div>

      <!-- Dokter -->
            <div class="card card-step">
                <div class="card-header">
                    <span>3. Dokter (Register User + Profil)</span>
                    <small>Hanya Admin</small>
                </div>
                <div class="card-body">
                    <form id="doctor-register-form" class="mb-1">
                        <h6 class="mb-2">Register Akun Dokter</h6>
                        <div class="mb-2">
                            <label class="form-label">Nama</label>
                            <input type="text" class="form-control" id="docName"
                                   placeholder="Dr. Andi" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="docEmail"
                                   placeholder="dokter@example.com" required>
                        </div>
                        <div class="mb-2">
                            <label class="form-label">Kata Sandi</label>
                            <input type="password" class="form-control" id="docPassword"
                                   placeholder="Password dokter" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">No. HP</label>
                            <input type="text" class="form-control" id="docPhone"
                                   placeholder="No. HP dokter" required>
                        </div>

                        <h6 class="mt-1 mb-2">Data Dokter (Profil)</h6>
                        <div class="mb-2">
                            <label class="form-label">Spesialisasi</label>
                            <input type="text" class="form-control" id="docSpec"
                                   placeholder="Umum / Anak / dll" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">clinic_id</label>
                            <input type="text" class="form-control" id="docClinicId"
                                   placeholder="clinic-001" required>
                            <div class="form-text">
                                Ambil dari tabel klinik di atas.
                            </div>
                        </div>

                        <button type="submit" class="btn btn-warning w-100">
                            Register Dokter + Simpan Profil
                        </button>
                    </form>
                </div>
            </div>
        </div>
    <div class="row g-4">
        <div class="col-lg-4">
            <!-- Login Dokter -->
            <div class="card card-step mb-4">
                <div class="card-header">
                    <span>6. Login sebagai Dokter</span>
                    <small>JWT Access Token</small>
                </div>
                <div class="card-body">
                    <form id="doctor-login-form" class="mb-2">
                        <div class="mb-3">
                            <label class="form-label">Email Dokter</label>
                            <input type="email" class="form-control" id="doctorEmail"
                                   placeholder="dokter@example.com" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Kata Sandi Dokter</label>
                            <input type="password" class="form-control" id="doctorPassword"
                                   placeholder="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            Login Dokter
                        </button>
                    </form>

                    <div class="mt-2">
                        <small class="text-muted d-block mb-1">Status login dokter:</small>
                        <span id="loginStatus" class="badge bg-danger-subtle text-danger">
                            Belum login
                        </span>
                    </div>

                    <div class="mt-3 small text-muted">
                        Token dokter (JWT): <span id="doctorTokenPreview">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Complete & Call Queue -->
        <div class="col-lg-8">
            <div class="card card-step mb-4">
                <div class="card-header">
                    <span>7. Selesaikan Antrean (Panggil + Complete)</span>
                    <span class="badge rounded-pill text-bg-success-subtle text-success">
                        Data ala Kaggle
                    </span>
                </div>
                <div class="card-body">
                    <form id="complete-queue-form" class="row g-3">
                        <div class="col-12">
                            <label class="form-label">Queue ID</label>
                            <input type="text" class="form-control" id="queueId"
                                   placeholder="klik antrean di tabel atau isi manual" required>
                            <div class="form-text">
                                Dipilih dari tabel antrean di bawah atau dari respons pasien.
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Keluhan / Alasan Kunjungan</label>
                            <input type="text" class="form-control" id="reason"
                                   value="Demam dan batuk" required>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Jumlah Pembayaran</label>
                            <input type="number" class="form-control" id="paymentAmount"
                                   value="200000" required>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Metode Pembayaran</label>
                            <select class="form-control" id="modeOfPayment" required>
                                <option value="Transfer">Transfer</option>
                                <option value="Cash" selected>Cash</option>
                                <option value="Qris">QRIS</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Jenis Kunjungan</label>
                            <select class="form-control" id="modeOfAppointment" required>
                                <option value="In Person" selected>Tatap Muka (In Person)</option>
                                <option value="Telepon">Telepon</option>
                                <option value="Online">Online / Video Call</option>
                            </select>
                        </div>

                        <div class="col-12 d-flex flex-wrap gap-2 mt-1">
                            <button type="button" id="btnCallQueue" class="btn btn-outline-primary">
                                Panggil Antrean (ubah ke IN_SERVICE)
                            </button>

                            <button type="submit" class="btn btn-success">
                                Selesaikan Antrean dengan Data Kaggle
                            </button>

                            <button type="button" id="btnResetForm" class="btn btn-outline-secondary">
                                Reset Formulir
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Daftar Antrean -->
            <div class="card card-step">
                <div class="card-header">
                    <span>8. Daftar Antrean Aktif</span>
                    <button id="btnLoadQueues" class="btn btn-sm btn-outline-primary">
                        Muat Antrean
                    </button>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm align-middle mb-0">
                            <thead class="table-light">
                            <tr>
                                <th>Queue ID</th>
                                <th>No. Antrean</th>
                                <th>Pasien</th>
                                <th>Klinik</th>
                                <th>Status</th>
                            </tr>
                            </thead>
                            <tbody id="queueTableBody">
                            <tr>
                                <td colspan="5" class="text-muted text-center py-3">
                                    Belum ada data. Login dokter lalu klik <strong>Muat Antrean</strong>.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <small class="text-muted d-block mt-2">
                        Klik baris antrean untuk mengisi <strong>Queue ID</strong> secara otomatis.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // kosong = pakai origin yang sama, jadi http://127.0.0.1:8000
    const BASE_URL = "";

    let adminToken = null;   // session_token admin
    let patientToken = null; // session_token patient
    let doctorToken = null;  // session_token doctor

    function setApiResponse(data) {
        const el = document.getElementById("apiResponse");
        el.textContent = typeof data === "string"
            ? data
            : JSON.stringify(data, null, 2);
    }











    // ======================= ADMIN =======================

    document.getElementById("admin-register-form")
        .addEventListener("submit", async (e) => {
            e.preventDefault();
            const body = {
                name: document.getElementById("adminRegName").value,
                email: document.getElementById("adminRegEmail").value,
                password: document.getElementById("adminRegPassword").value,
                phone: document.getElementById("adminRegPhone").value,
                role: "admin"
            };
            try {
                const res = await fetch(`${BASE_URL}/api/auth/register`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(body)
                });
                const data = await res.json();
                setApiResponse(data);
                alert(res.ok ? "Register admin berhasil" : "Register admin gagal");
            } catch (err) {
                console.error(err);
                setApiResponse("Error koneksi (register admin)");
            }
        });

    document.getElementById("admin-login-form")
        .addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("adminEmail").value;
            const password = document.getElementById("adminPassword").value;
            const status = document.getElementById("adminStatus");
            const tokenPrev = document.getElementById("adminTokenPreview");

            status.textContent = "Proses login...";
            status.className = "badge bg-warning-subtle text-warning";

            try {
                const res = await fetch(`${BASE_URL}/api/auth/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();
                setApiResponse(data);

                if (!res.ok) {
                    status.textContent = "Gagal login: " + (data.detail || res.status);
                    status.className = "badge bg-danger-subtle text-danger";
                    adminToken = null;
                    tokenPrev.textContent = "-";
                    return;
                }

                adminToken = data.session_token;
                status.textContent = "Login admin OK";
                status.className = "badge bg-success-subtle text-success";
                tokenPrev.textContent = adminToken.substring(0, 25) + "...";

                await loadClinics();
            } catch (err) {
                console.error(err);
                status.textContent = "Error koneksi";
                status.className = "badge bg-danger-subtle text-danger";
            }
        });

    // ======================= KLINIK =======================

    document.getElementById("clinic-form")
        .addEventListener("submit", async (e) => {
            e.preventDefault();
            if (!adminToken) {
                alert("Harus login admin dulu.");
                return;
            }
            const body = {
                name: document.getElementById("clinicName").value,
                description: document.getElementById("clinicDesc").value || null
            };
            try {
                const res = await fetch(`${BASE_URL}/api/clinics`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-Session-Token": adminToken
                    },
                    body: JSON.stringify(body)
                });
                const data = await res.json();
                setApiResponse(data);
                alert(res.ok ? "Klinik tersimpan" : "Gagal menyimpan klinik");
                if (res.ok) await loadClinics();
            } catch (err) {
                console.error(err);
                setApiResponse("Error koneksi (buat klinik)");
            }
        });

async function loadClinics() {
    const res = await fetch(`${BASE_URL}/api/clinics/all`);
    const data = await res.json();

    const clinicTable = document.getElementById("clinicTableBody");
    const selectClinic = document.getElementById("docClinicSelect");

    clinicTable.innerHTML = "";
    selectClinic.innerHTML = `<option value="">-- pilih klinik --</option>`;

    data.forEach(c => {
        clinicTable.innerHTML += `
            <tr>
                <td>${c.id}</td>
                <td>${c.name}</td>
            </tr>
        `;

        selectClinic.innerHTML += `<option value="${c.id}">${c.name}</option>`;
    });
}

document.getElementById("clinic-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const body = {
        name: document.getElementById("clinicName").value,
        description: document.getElementById("clinicDesc").value
    };

    const res = await fetch(`${BASE_URL}/api/clinics/create`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${adminToken}`
        },
        body: JSON.stringify(body)
    });

    await res.json();
    loadClinics();
});

document.getElementById("doctor-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const body = {
        name: document.getElementById("docName").value,
        email: document.getElementById("docEmail").value,
        password: document.getElementById("docPassword").value,
        phone: document.getElementById("docPhone").value,
        specialization: document.getElementById("docSpec").value,
        clinic_id: document.getElementById("docClinicSelect").value
    };

    const res = await fetch(`${BASE_URL}/api/doctors/register`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${adminToken}`
        },
        body: JSON.stringify(body)
    });

    await res.json();
    loadDoctors();
});

async function loadDoctors() {
    const res = await fetch(`${BASE_URL}/api/doctors/all`);
    const data = await res.json();

    const tbody = document.getElementById("doctorTableBody");
    tbody.innerHTML = "";

    data.forEach(d => {
        tbody.innerHTML += `
            <tr>
                <td>${d.id}</td>
                <td>${d.name}</td>
                <td>${d.clinic_name}</td>
            </tr>
        `;
    });
}

// ===================== LOAD KLINIK =====================
document.getElementById("btnLoadClinics").addEventListener("click", loadClinics);

async function loadClinics() {
    const res = await fetch(`${BASE_URL}/api/clinics/all`);
    const clinics = await res.json();

    const tableBody = document.getElementById("clinicTableBody");
    const clinicSelect = document.getElementById("docClinicSelect");

    tableBody.innerHTML = "";
    clinicSelect.innerHTML = `<option value="">-- pilih klinik --</option>`;

    clinics.forEach(c => {
        // Tabel Klinik
        tableBody.innerHTML += `
            <tr>
                <td>${c.id}</td>
                <td>${c.name}</td>
            </tr>
        `;

        // Dropdown Dokter
        clinicSelect.innerHTML += `
            <option value="${c.id}">${c.name}</option>
        `;
    });
}



// ===================== SIMPAN DOKTER =====================
document.getElementById("doctor-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const clinic_id = document.getElementById("docClinicSelect").value;

    const body = {
        name: document.getElementById("docName").value,
        email: document.getElementById("docEmail").value,
        password: document.getElementById("docPassword").value,
        phone: document.getElementById("docPhone").value,
        specialization: document.getElementById("docSpec").value,
        clinic_id: clinic_id
    };

    const res = await fetch(`${BASE_URL}/api/doctors/register`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + adminToken
        },
        body: JSON.stringify(body)
    });

    const data = await res.json();
    setApiResponse(data);

    // Refresh tabel dokter
    loadDoctors();
});


document.getElementById("btnLoadClinics").addEventListener("click", loadClinics);


    async function loadClinics() {
        const tbody = document.getElementById("clinicTableBody");
        if (!adminToken) {
            tbody.innerHTML =
                `<tr><td colspan="2" class="text-muted text-center">Harus login admin dulu.</td></tr>`;
            return;
        }
        tbody.innerHTML =
            `<tr><td colspan="2" class="text-muted text-center">Memuat klinik...</td></tr>`;
        try {
            const res = await fetch(`${BASE_URL}/api/clinics`, {
                headers: { "X-Session-Token": adminToken }
            });
            const data = await res.json();
            setApiResponse(data);

            if (!res.ok) {
                tbody.innerHTML =
                    `<tr><td colspan="2" class="text-danger text-center">Gagal memuat klinik: ${data.detail || res.status}</td></tr>`;
                return;
            }

            const clinics = data.clinics || [];
            if (!clinics.length) {
                tbody.innerHTML =
                    `<tr><td colspan="2" class="text-muted text-center">Belum ada klinik.</td></tr>`;
                return;
            }

            tbody.innerHTML = "";
            clinics.forEach(c => {
                const tr = document.createElement("tr");
                tr.innerHTML = `<td>${c.id}</td><td>${c.name}</td>`;
                tbody.appendChild(tr);
            });
        } catch (err) {
            console.error(err);
            tbody.innerHTML =
                `<tr><td colspan="2" class="text-danger text-center">Error koneksi.</td></tr>`;
        }
    }

    document.getElementById("btnLoadClinics")
        .addEventListener("click", loadClinics);

    // ======================= DOKTER (REGISTER) =======================

    document.getElementById("doctor-register-form")
        .addEventListener("submit", async (e) => {
            e.preventDefault();
            if (!adminToken) {
                alert("Harus login admin dulu.");
                return;
            }
            const name = document.getElementById("docName").value;
            const email = document.getElementById("docEmail").value;
            const password = document.getElementById("docPassword").value;
            const phone = document.getElementById("docPhone").value;
            const specialization = document.getElementById("docSpec").value;
            const clinic_id = document.getElementById("docClinicId").value;

            try {
                // 1. register user dokter
                const resUser = await fetch(`${BASE_URL}/api/auth/register`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        name, email, password, phone, role: "doctor"
                    })
                });
                const dataUser = await resUser.json();
                setApiResponse(dataUser);
                if (!resUser.ok) {
                    alert("Register akun dokter gagal");
                    return;
                }

                // 2. simpan profil dokter
                const resDoc = await fetch(`${BASE_URL}/api/doctors`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-Session-Token": adminToken
                    },
                    body: JSON.stringify({
                        name,
                        specialization,
                        clinic_id,
                        phone
                    })
                });
                const dataDoc = await resDoc.json();
                setApiResponse(dataDoc);

                if (resDoc.ok) {
                    alert("Dokter berhasil dibuat. Lihat doctor_id di respons.");

                    // AUTO-FILL doctor_id ke form antrean pasien
                    if (dataDoc.doctor && dataDoc.doctor.id) {
                        document.getElementById("queueDoctorId").value = dataDoc.doctor.id;
                    }
                } else {
                    alert("Menyimpan data dokter gagal");
                }
            } catch (err) {
                console.error(err);
                setApiResponse("Error koneksi (dokter)");
            }
        });

    // ======================= PASIEN =======================

    document.getElementById("patient-register-form")
        .addEventListener("submit", async (e) => {
            e.preventDefault();
            const body = {
                name: document.getElementById("patName").value,
                email: document.getElementById("patEmail").value,
                password: document.getElementById("patPassword").value,
                phone: document.getElementById("patPhone").value,
                role: "patient"
            };
            try {
                const res = await fetch(`${BASE_URL}/api/auth/register`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(body)
                });
                const data = await res.json();
                setApiResponse(data);
                alert(res.ok ? "Register pasien berhasil" : "Register pasien gagal");
            } catch (err) {
                console.error(err);
                setApiResponse("Error koneksi (register pasien)");
            }
        });

    document.getElementById("patient-login-form")
        .addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("patLoginEmail").value;
            const password = document.getElementById("patLoginPassword").value;

            const status = document.getElementById("patientStatus");
            const tokenPrev = document.getElementById("patientTokenPreview");

            status.textContent = "Proses login...";
            status.className = "badge bg-warning-subtle text-warning";

            try {
                const res = await fetch(`${BASE_URL}/api/auth/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();
                setApiResponse(data);

                if (!res.ok) {
                    status.textContent = "Gagal login: " + (data.detail || res.status);
                    status.className = "badge bg-danger-subtle text-danger";
                    patientToken = null;
                    tokenPrev.textContent = "-";
                    return;
                }

                patientToken = data.session_token;
                status.textContent = "Login pasien OK";
                status.className = "badge bg-success-subtle text-success";
                tokenPrev.textContent = patientToken.substring(0, 25) + "...";
            } catch (err) {
                console.error(err);
                status.textContent = "Error koneksi";
                status.className = "badge bg-danger-subtle text-danger";
            }
        });

    // ======================= PASIEN – DAFTAR ANTREAN =======================

    document.getElementById("queue-register-form")
        .addEventListener("submit", async (e) => {
            e.preventDefault();
            if (!patientToken) {
                alert("Harus login pasien dulu.");
                return;
            }
            const clinic_id = document.getElementById("queueClinicId").value;
            const doctor_id = document.getElementById("queueDoctorId").value;

            try {
                const res = await fetch(`${BASE_URL}/api/queues/register`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-Session-Token": patientToken
                    },
                    body: JSON.stringify({ clinic_id, doctor_id })
                });
                const data = await res.json();
                setApiResponse(data);
                alert(res.ok
                    ? "Daftar antrean berhasil. Simpan queue.id dari respons."
                    : "Gagal mendaftar antrean");
            } catch (err) {
                console.error(err);
                setApiResponse("Error koneksi (daftar antrean)");
            }
        });

       // PASIEN – CEK STATUS ANTREAN
document.getElementById("btnCheckQueue").addEventListener("click", async () => {
    const qid = document.getElementById("queueCheckInput").value;
    const tbody = document.getElementById("queueCheckTableBody");

    if (!patientToken) {
        tbody.innerHTML = `
            <tr><td colspan="5" class="text-danger text-center py-3">
                Pasien harus login terlebih dahulu.
            </td></tr>`;
        return;
    }

    if (!qid) {
        tbody.innerHTML = `
            <tr><td colspan="5" class="text-warning text-center py-3">
                Masukkan Queue ID.
            </td></tr>`;
        return;
    }

    const res = await fetch(`${BASE_URL}/api/queues/check/${qid}`, {
        method: "GET",
        headers: {
            "Authorization": `Bearer ${patientToken}`
        }
    });

    const data = await res.json();

    // Jika error
    if (!res.ok) {
        tbody.innerHTML = `
            <tr><td colspan="5" class="text-danger text-center py-3">
                ${data.detail || "Queue tidak ditemukan"}
            </td></tr>`;
        return;
    }

    // Render tabel
    tbody.innerHTML = `
        <tr>
            <td>${data.id}</td>
            <td>${data.queue_number}</td>
            <td><span class="badge text-bg-info">${data.status}</span></td>
            <td>${data.doctor_name || "-"}</td>
            <td>${data.clinic_name || "-"}</td>
        </tr>
    `;
});



    // ======================= DOKTER – LOGIN =======================

    document.getElementById("doctor-login-form")
        .addEventListener("submit", async (event) => {
            event.preventDefault();

            const email = document.getElementById("doctorEmail").value;
            const password = document.getElementById("doctorPassword").value;

            const loginStatus = document.getElementById("loginStatus");
            loginStatus.textContent = "Proses login...";
            loginStatus.className = "badge bg-warning-subtle text-warning";

            try {
                const res = await fetch(`${BASE_URL}/api/auth/login`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();
                setApiResponse(data);

                if (!res.ok) {
                    loginStatus.textContent = "Gagal login: " + (data.detail || res.status);
                    loginStatus.className = "badge bg-danger-subtle text-danger";
                    doctorToken = null;
                    document.getElementById("doctorTokenPreview").innerText = "-";
                    return;
                }

                // backend mengembalikan session_token
                doctorToken = data.session_token;

                loginStatus.textContent = "Login dokter berhasil";
                loginStatus.className = "badge bg-success-subtle text-success";

                if (doctorToken) {
                    document.getElementById("doctorTokenPreview").innerText =
                        doctorToken.substring(0, 25) + "...";
                } else {
                    document.getElementById("doctorTokenPreview").innerText = "-";
                }

                await loadQueues();
            } catch (err) {
                console.error(err);
                loginStatus.textContent = "Error koneksi ke server";
                loginStatus.className = "badge bg-danger-subtle text-danger";
            }
        });

    // ======================= DOKTER – COMPLETE QUEUE =======================

    document.getElementById("complete-queue-form")
        .addEventListener("submit", async function (event) {
            event.preventDefault();

            if (!doctorToken) {
                alert("Harus login sebagai dokter dulu.");
                return;
            }

            const queueId = document.getElementById("queueId").value.trim();
            const reason = document.getElementById("reason").value;
            const payment_amount = Number(document.getElementById("paymentAmount").value);
            const mode_of_payment = document.getElementById("modeOfPayment").value;
            const mode_of_appointment = document.getElementById("modeOfAppointment").value;

            try {
                const res = await fetch(`${BASE_URL}/api/queues/${queueId}/complete`, {
                    method: "PATCH",
                    headers: {
                        "Content-Type": "application/json",
                        "X-Session-Token": doctorToken
                    },
                    body: JSON.stringify({
                        reason,
                        payment_amount,
                        mode_of_payment,
                        mode_of_appointment
                    })
                });

                const data = await res.json();
                setApiResponse(data);
                await loadQueues();
            } catch (err) {
                console.error(err);
                setApiResponse("Error koneksi (complete queue)");
            }
        });

    document.getElementById("btnResetForm")
        .addEventListener("click", function () {
            document.getElementById("complete-queue-form").reset();
        });




        // ===================== LOAD KLINIK =====================
document.getElementById("btnLoadClinics").addEventListener("click", loadClinics);

async function loadClinics() {
    const res = await fetch(`${BASE_URL}/api/clinics/all`);
    const clinics = await res.json();

    const tableBody = document.getElementById("clinicTableBody");
    const clinicSelect = document.getElementById("docClinicSelect");

    tableBody.innerHTML = "";
    clinicSelect.innerHTML = `<option value="">-- pilih klinik --</option>`;

    clinics.forEach(c => {
        // Tabel Klinik
        tableBody.innerHTML += `
            <tr>
                <td>${c.id}</td>
                <td>${c.name}</td>
            </tr>
        `;

        // Dropdown Dokter
        clinicSelect.innerHTML += `
            <option value="${c.id}">${c.name}</option>
        `;
    });
}

// ===================== SIMPAN DOKTER =====================
document.getElementById("doctor-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const clinic_id = document.getElementById("docClinicSelect").value;

    const body = {
        name: document.getElementById("docName").value,
        email: document.getElementById("docEmail").value,
        password: document.getElementById("docPassword").value,
        phone: document.getElementById("docPhone").value,
        specialization: document.getElementById("docSpec").value,
        clinic_id: clinic_id
    };

    const res = await fetch(`${BASE_URL}/api/doctors/register`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + adminToken
        },
        body: JSON.stringify(body)
    });

    const data = await res.json();
    setApiResponse(data);

    // Refresh tabel dokter
    loadDoctors();
});

// ===================== LOAD TABEL DOKTER =====================
async function loadDoctors() {
    const res = await fetch(`${BASE_URL}/api/doctors/all`);
    const doctors = await res.json();

    const table = document.getElementById("doctorTableBody");
    table.innerHTML = "";

    doctors.forEach(d => {
        table.innerHTML += `
            <tr>
                <td>${d.id}</td>
                <td>${d.name}</td>
                <td>${d.clinic_name || d.clinic_id}</td>
            </tr>
        `;
    });
}



    // ======================= DOKTER – CALL QUEUE =======================

    document.getElementById("btnCallQueue")
        .addEventListener("click", async () => {
            if (!doctorToken) {
                alert("Harus login dokter dulu.");
                return;
            }
            const queueId = document.getElementById("queueId").value.trim();
            if (!queueId) {
                alert("Isi Queue ID dulu (klik dari tabel).");
                return;
            }

            try {
                const res = await fetch(`${BASE_URL}/api/queues/${queueId}/call`, {
                    method: "PATCH",
                    headers: {
                        "Content-Type": "application/json",
                        "X-Session-Token": doctorToken
                    }
                });
                const data = await res.json();
                setApiResponse(data);
                await loadQueues();
            } catch (err) {
                console.error(err);
                setApiResponse("Error koneksi (call queue)");
            }
        });

    // ======================= DOKTER – LIST QUEUES =======================

    async function loadQueues() {
        const tbody = document.getElementById("queueTableBody");

        if (!doctorToken) {
            tbody.innerHTML =
                `<tr><td colspan="5" class="text-muted text-center">Harus login dokter dulu.</td></tr>`;
            return;
        }

        tbody.innerHTML =
            `<tr><td colspan="5" class="text-muted text-center">Memuat data antrean...</td></tr>`;

        try {
            const res = await fetch(`${BASE_URL}/api/queues`, {
                method: "GET",
                headers: {
                    "X-Session-Token": doctorToken
                }
            });

            const data = await res.json();
            setApiResponse(data);

            if (!res.ok) {
                tbody.innerHTML =
                    `<tr><td colspan="5" class="text-danger text-center">Gagal memuat antrean: ${data.detail || res.status}</td></tr>`;
                return;
            }

            const queues = data.queues || [];
            if (!queues.length) {
                tbody.innerHTML =
                    `<tr><td colspan="5" class="text-muted text-center">Tidak ada antrean.</td></tr>`;
                return;
            }

            tbody.innerHTML = "";
            queues.forEach(q => {
                const tr = document.createElement("tr");
                tr.className = "queue-row";

                tr.innerHTML = `
                    <td class="text-truncate" style="max-width: 220px;">${q.id}</td>
                    <td>${q.queue_number}</td>
                    <td>${q.patient_name}</td>
                    <td>${q.clinic_name}</td>
                    <td><span class="badge badge-status text-bg-secondary">${q.status}</span></td>
                `;

                tr.addEventListener("click", () => {
                    document.getElementById("queueId").value = q.id;
                });

                tbody.appendChild(tr);
            });
        } catch (err) {
            console.error(err);
            tbody.innerHTML =
                `<tr><td colspan="5" class="text-danger text-center">Error koneksi ke server.</td></tr>`;
        }
    }

    document.getElementById("btnLoadQueues")
        .addEventListener("click", loadQueues);
</script>




</body>
</html>
